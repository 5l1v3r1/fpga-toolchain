sudo: required
dist: bionic
language: cpp
matrix:
  include:
    - os: osx
      env: ARCH=darwin EXT=tar.gz MACOSX_DEPLOYMENT_TARGET=10.10
      addons:
        homebrew:
          packages:
            - bison
            - flex
            - gawk
            - cmake
            - git
            - pkg-config
            - gnu-sed
            - wget
            - eigen
    - os: linux
      env: ARCH=linux_x86_64 EXT=tar.gz
    - os: linux
      env: ARCH=linux_i686 EXT=tar.gz
    - os: linux
      env: ARCH=linux_armv7l EXT=tar.gz
    - os: linux
      env: ARCH=linux_aarch64 EXT=tar.gz
    - os: linux
      env: ARCH=windows_x86 EXT=zip
    - os: linux
      env: ARCH=windows_amd64 EXT=zip

before_script:
  - if [[ ${ARCH:0:7} == "windows" ]]; then sudo dpkg --add-architecture i386; fi
  - if [[ "$ARCH" == "linux_i686" ]]; then sudo dpkg --add-architecture i386; fi
  - if [[ "$ARCH" == "linux_armv7l" ]]; then sudo dpkg --add-architecture armhf; fi
  - if [[ "$ARCH" == "linux_aarch64" ]]; then sudo dpkg --add-architecture arm64; fi
  - if [[ "$TRAVIS_OS_NAME" == "linux" ]]; then sudo apt-get update -y -qq; fi
script:
  - bash build.sh $ARCH
  - openssl sha1 _packages/**/*.$EXT
# deploy:
#   provider: releases
#   api_key:
#     secure: <>
#   file:
#     - _packages/**/*.tar.gz
#     - _packages/**/*.zip
#   file_glob: true
#   skip_cleanup: true
#   on:
#     repo: open-tool-forge/fpga-toolchain
#     all_branches: true
#     tags: true
branches:
  only:
    # Release tags
    - /^v\d+\.\d+/
    - master
notifications:
  email:
    on_success: change
